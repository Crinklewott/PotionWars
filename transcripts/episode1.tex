\documentclass{book}
\usepackage{sprpgs}
\usepackage[T1]{fontenc}
\usepackage{upquote}
\usepackage{cmap}
%\usepackage{underscore}

\title{Pandemonium Cycle: The Potion Wars \\ Episode 1: Tension}
\author{Andrew Russell}
\date{\today}
\renewcommand{\episode}{1}

\begin{document}
\maketitle
\begin{openScene}
    universal.state.clear_previous_scene()
    universal.state.set_init_scene(init_episode_1_scene_1)
    assert(universal.state.player)
    carol = universal.state.get_character('Carol.person')
    peter = universal.state.get_character('Peter.person')
    maria = universal.state.get_character('Maria.person')
    elise = universal.state.get_character('Elise.person')
    adrian = universal.state.get_character('Adrian.person')
    southGuard = universal.state.get_character('Guard.person')
    
    edge = universal.state.get_room(edgeOfAvaricum)
    guild = universal.state.get_room("Adventurer's Guild")
    square = universal.state.get_room("Avaricum Square")
    stateShrine = universal.state.get_room(shrine)
    tailors = universal.state.get_room("Therese's Tailors)
    armorShop = universal.state.get_room("Wesley and Anne's Smithy")
    slums = universal.state.get_room("Slums")
    craftmansCorridor = universal.state.get_room("Craftman's Corridor")
    mariasHome = universal.state.get_room("Maria's Home")
    bedroom = universal.state.get_room("Bedroom")

    edge.add_adjacent(square)
    square.add_adjacent(stateShrine)
    square.add_adjacent(craftmansCorridor)
    craftmansCorridor.add_adjacent(guild)
    craftmansCorridor.add_adjacent(tailors)
    craftmansCorridor.add_adjacent(armorShop)
    craftmansCorridor.add_adjacent(slums)
    slums.add_adjacent(mariasHome)

    if 'boarding\_with\_Adrian' in pwutilities.keywords():
        adventurersGuild.add_adjacent(bedroom)

    if not loading:
        townmode.set_current_room(townmode.offStage)
        townmode.go(edge)
        universal.state.player.take_item(itemspotionwars.woodenSpoon)
        enterLeft(adrian, guild)
        enterLeft(maria, square)
        enterLeft(southGuard, edge)
        enterLeft(elise, stateShrine)
        enterLeft(peter, armorShop)
        enterLeft(carol, tailors)

    def south_guard_scene(): 
        if not 'spoke_to_guard' in universal.state.player.keywords:
            southGuard = universal.state.get_character('Guard.person')
            southGuard.litany = guard_greeting_1_1.index
            conversation.converse_with(southGuard, townmode.town_mode)
        else:
            townmode.town_mode()
    square.after_arrival = south_guard_scene

\end{openScene}

\begin{node}{ep1 carol first greeting}{Therese's Taylors}{Carol}{Andrew Russell}

    "Hello," says the young woman, her eyes flicking over \name{}. She smiles with a hint of uneasiness. "My name is Carol. How can I help you today?"

    \begin{code}

        universal.state.get_character("Carol.person").printedName = "Carol"

    \end{code}

    \child{"This is amazing! How did you make all of this? Surely not by hand."}{ep1 carol make}

    \child{"Are you hiring?"}{ep1 carol work}

    \child{"I'd like to buy or sell something."}{ep1 carol buy}

    \child{"I think I'll be going now."}{ep1 carol leave}

\end{node}

\begin{childnode}{ep1 carol greeting}{Andrew Russell}

    Carol flashes a professional, toothy smile. "Welcome back. How can I help you today?"

    \continue{ep1 carol questions}

\end{childnode}

\begin{childnode}{ep1 carol questions}{Andrew Russell}

    \childif{'asked\_Carol\_about\_work' in pwutilities.keywords() and 'asked\_Carol\_about\_clothing' in pwutilities.keywords()}{ep1 carol greeting no work and no clothing}

    \childelif{'asked\_Carol\_about\_work' in pwutilities.keywords()}{ep1 carol greeting no work}

    \childelif{'asked\_Carol\_about\_clothing' in pwutilities.keywords()}{ep1 carol greeting no clothing}

    \childelif{True}{ep1 carol all questions}

\end{childnode}

\begin{childnode}{ep1 carol greeting no work and no clothing}{Andrew Russell}

    \child{"I'd like to buy or sell something."}{ep1 carol buy}

    \child{"I think I'll be going now."}{ep1 carol leave}

\end{childnode}

\begin{childnode}{ep1 carol greeting no work}{Andrew Russell}

    \child{"This is amazing! How did you make all of this? Surely not by hand."}{ep1 carol make}

    \child{"I'd like to buy or sell something."}{ep1 carol buy}

    \child{"I think I'll be going now."}{ep1 carol leave}

\end{childnode}

\begin{childnode}{ep1 carol greeting no clothing}{Andrew Russell}

    \child{"Are you hiring?"}{ep1 carol work}

    \child{"I'd like to buy or sell something."}{ep1 carol buy}

    \child{"I think I'll be going now."}{ep1 carol leave}

\end{childnode}

\begin{childnode}{ep1 carol all questions}{Andrew Russell}

    \child{"This is amazing! How did you make all of this? Surely not by hand."}{ep1 carol make}

    \child{"Are you hiring?"}{ep1 carol work}

    \child{"I'd like to buy or sell something."}{ep1 carol buy}

    \child{"I think I'll be going now."}{ep1 carol leave}

\end{childnode}

\begin{childnode}{ep1 carol buy}{Andrew Russell}

    \stageDirections{At this point, we transition into the buying and selling screen.}

    \begin{code}

        carol.litany = carol.defaultLitany = ep1_carol_greeting.index
        return (shopmode.shop_mode, [carol])

    \end{code}

\end{childnode}

\begin{childnode}{ep1 carol work}{Andrew Russell}

    \keyword{'asked\_Carol\_about\_work'}

    Carol grimaces, and gives \name{} a quick look-over. "I'm sorry, but we're not currently hiring now. Is there anything else I can do for you?"

    \continue{ep1 carol questions}

\end{childnode}

\begin{childnode}{ep1 carol make}{Andrew Russell}

    Carol smiles conspiratorially. "That's our little secret. All I'm allowed to say is that a bit of magic's involved."

    \keyword{'asked\_Carol\_about\_clothing'}

    \continue{ep1 carol questions}

\end{childnode}

\begin{childnode}{ep1 carol leave}{Andrew Russell}

    "Well, have a nice day. I hope to see you again."

    \begin{code}

        carol = universal.state.get_character("Carol.person")

        carol.litany = carol.defaultLitany = ep1_carol_greeting.index

    \end{code}

\end{childnode}

\begin{node}{ep1 guard greeting}{southGuard}{Andrew Russell}

The guard on the south side of the road blocks \names{} path with an arm. 
    He is a broad-shouldered, heavily muscled brute of a man. At over six feet tall, he towers over just about everyone else on the road. The large, steel-tipped
    spear he carries only adds to his intimidating appearance. "I'd like to ask you a few questions."

\name{} hesitates for a moment, then steps onto the side of the road, making sure to keep \hisher{} distance. 

"What's your name?" asks the guard.

\child{"I don't have to answer that."}{ep2 guard refuse answer name}

\child{\name{}}{ep2 guard respond name}

\child{\fakename{}}{ep2 guard fake name}

\end{node}

\begin{childnode}{ep2 guard refuse answer name}{Andrew Russell}

"Actually, yes you do," says the guard. "Unless you want to be thrown in the dungeons for a while."

\name{} grimaces. Although, there's nothing stopping \himher{} from giving a fake name...

\child{\name{}}{ep2 guard respond name}

\child{\fakename{}}{ep2 guard fake name}

\end{childnode}

\begin{childnode}{ep2 guard respond name}{Andrew Russell}

    "Excellent," says the guard. "Sorry for this \name{}, but it's strict policy that we question every Taironan that tries to enter the city."

\continue{ep1 guard questions 2}

\end{childnode}

\begin{childnode}{ep2 guard fake name}{Andrew Russell}

    "Excellent," says the guard. "Sorry for this \fakename{}, but it's strict policy that we question every Taironan that tries to enter the city."

    \continue{ep1 guard questions 2}

\end{childnode}

\begin{childnode}{ep1 guard questions 2}{Andrew Russell}

    "You are a Taironan, correct?"

    \child{Sarcasm: "No, I'm the one person in the city with brown skin who doesn't have a drop of Taironan blood in \himher{}. Crazy, right?"}{ep1 question 2 sarcasm}

    \child{"I am."}{ep1 question 2 answer}

\end{childnode}

\begin{childnode}{ep1 question 2 sarcasm}{Andrew Russell}

The guard scowls. "Your sarcasm is not appreciated \mistermiss{} . It's just protocol."

\continue{ep1 guard questions 3}

\end{childnode}

\begin{childnode}{ep1 question 2 answer}{Andrew Russell}

    The guard nods.

    \continue{ep1 guard questions 3}

\end{childnode}

\begin{childnode}{ep1 guard questions 3}{Andrew Russell}

    "When was the last time you were in Bonda?"

    \child{"None of your business."}{ep1 guard questions 3 business}

    \child{"LIE: I've never been to Bonda. I was born and raised in Chengue."}{ep1 guard questions 3 lie}

    \child{"I was born in Bonda, but my family left when I was about three, when the Potion Riots began. I was raised in Chengue."}{ep1 guard questions 3 truth}

\end{childnode}

\begin{childnode}{ep1 guard questions 3 business}{Andrew Russell}

The guard scowls. "It is my business, because the safety of this city is my business."

"What does the last time I was in Bonda have to do with the safety of this city?" asks \name{}, crossing \hisher{} arms over \hisher{} chest.

"There has been a rash of attacks against this city by a Taironan terrorist group calling themselves the Harapiento Vengadores-"

"And because I'm Taironan you naturally assume I'm involved," snaps \name{}.

"I'm tempted," says the guard in a low growl. "These are exclusively Taironan rebels. Focusing on Taironans is a lot easier than questioning everyone. Now, are you going to answer my questions, or 
will I have to haul you off to the guardhouse to be questioned there?"

\child{"The Tyrant take you."}{ep1 guardhouse}

\child{"LIE: I've never been to Bonda. I was born and raised in Chengue."}{ep1 guard questions 3 lie}

\child{"I was born in Bonda, but my family left when I was about three, when the Potion Riots began. I was raised in Chengue."}{ep1 guard questions 3 truth}

\end{childnode}

\begin{childnode}{ep1 guard questions 3 lie}{Andrew Russell}

    \keyword{'lied\_about\_Bonda'}

"You've never been to Bonda? I find that hard to believe," says the guard.

"You do realize the Taironans are an entire civilization with well over a dozen major city-states, dozens more smaller towns, and hundreds of villages, right?" says \name{} testily. "I was born and 
raised in Chengue, an unremarkable city-state of average wealth and minor influence. Even when conditions are good, it takes a week to reach Bonda from there."

The guard studies \name{} for a minute, obviously trying to decide if \heshe{} is lying. Then, he shrugs. "Very well."

\continue{ep1 guard questions 4}

\end{childnode}

\begin{childnode}{ep1 guard questions 3 truth}{Andrew Russell}

    "I see," says the guard. He studies \name{} for a moment, probably trying to decide if \heshe{} looks young enough for \hisher{} story to make sense. He nods, apparently satisfied.

\continue{ep1 guard questions 4}

\end{childnode}

\begin{childnode}{ep1 guard questions 4}{Andrew Russell}

    "And you were raised by your parents?"

    \child{"My father died when I was young, and my mother left soon after. I was raised by my Nana, a woman named Reyna."}{ep1 raised truth}

    \child{"LIE: Yes, I was raised by my mother."}{ep1 raised lie}

\end{childnode}

\begin{childnode}{ep1 raised truth}{Andrew Russell}

    "Interesting," says the guard.

    \continue{ep1 guard questions 5}

\end{childnode}

\begin{childnode}{ep1 raised lie}{Andrew Russell}

The guard nods. "And your mother is?"

"Reyna of Chengue," says \name{}.

"What happened to your father?" asks the guard.

"Died of the Wasting Wail," says \name{}.

"Sorry to hear that," says the guard.

\continue{ep1 guard questions 5}

\end{childnode}

\begin{childnode}{ep1 guard questions 5}{Andrew Russell}

"Last question. What's your business in Avaricum?"

\child{"I'm looking for work. Probably join the Adventurer's Guild."}{ep1 guard questions 5 looking for work}

\child{"I'm just visiting a friend of mine who lives here."}{ep1 guard questions 5 visiting a friend}

\end{childnode}

\begin{childnode}{ep1 guard questions 5 looking for work}{Andrew Russell}

    \keyword{'help\_guard'}

    \keyword{'spoke\_to\_guard'}

The guard nods, as if he expected that answer. "Please try to stay out of trouble. We have enough problems as it is without having to deal with adventurers drunkenly brawling and slinging spells in 
the streets."

"Of course," says \name{}.

\continue{ep1 guard questions 6}

\end{childnode}

\begin{childnode}{ep1 guard questions 5 visiting a friend}{Andrew Russell}

"And who is your friend?" asks the guard.

\child{"Maria of Chengue."}{ep1 guard friend maria}

\child{Lie: "A woman named Lola."}{ep1 guard friend lie}

\child{"I'm not answering that."}{ep1 not answering}

\end{childnode}

\begin{childnode}{ep1 guard friend maria}{Andrew Russell}

    \keyword{'claimed\_to\_be\_visiting\_Maria'}

    \keyword{'spoke\_to\_guard'}

    "We know of her," says the guard.

    "Really?"

    "She's had business with us before," says the guard.

    \continue{ep1 guard questions 6}

\end{childnode}

\begin{childnode}{ep1 guard friend lie}{Andrew Russell}

"I see," says the guard. "Well, that's the last of my questions."

\continue{ep1 guard questions 6}

\end{childnode}

\begin{childnode}{ep1 not answering}{Andrew Russell}

    "Yes, yes you are," says the guard. "You can answer it here, or at the guardhouse, but you're answering the question."

    \child{"Get buried.}{ep1 guardhouse}

    \child{"Maria of Chengue"}{ep1 guard friend maria}

    \child{Lie: "A woman named Lola."}{ep1 guard friend lie}

\end{childnode}

\begin{childnode}{ep1 guard questions 6}{Andrew Russell}

    "Alright. Welcome to Avaricum. If you see anything suspicious, please report it to us immediately. Lives may depend on it."

    \continue{ep1 begin marias scene}

\end{childnode}

\begin{childnode}{ep1 guardhouse}{Andrew Russell}

    \child{Resist.}{ep1 guardhouse resist}

    \child{Go quietly.}{ep1 guardhouse go quietly}

\end{childnode}

\begin{childnode}{ep1 guardhouse resist}{Andrew Russell}

\end{childnode}

\begin{childnode}{ep1 guardhouse go quietly}{Andrew Russell}

\end{childnode}

\begin{childnode}{ep1 begin marias scene}{Andrew Russell}

\end{childnode}

\end{document}
